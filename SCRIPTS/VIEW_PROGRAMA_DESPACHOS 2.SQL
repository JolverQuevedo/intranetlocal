ALTER VIEW [dbo].[VIEW_PROGRAMA_DESPACHOS]
AS
SELECT        ISNULL(PP.HOUSE, 0) AS HOUSE_PACKING, ES.ESTCLI, ES.DESCRIPCION AS DESESTILO, PP.PO, PP.OFI, PP.CANTIDAD AS CAN, CC.FOB, ISNULL(PP.BIG, 0) AS BIG,
                          ISNULL(PP.XBIG, 0) AS XBIG, CASE WHEN ISNULL(BIG, 0) > 0 THEN (BIG + ISNULL(HOUSE, 0)) * PP.CANTIDAD WHEN ISNULL(XBIG, 0) 
                         > 0 THEN (XBIG + ISNULL(HOUSE, 0)) * PP.CANTIDAD ELSE (CC.FOB + ISNULL(HOUSE, 0)) * PP.CANTIDAD END AS TOTAL, PR.MOTIVO AS FABRIC, 
                         ISNULL(PP.LLEGAPO, PP.FECHA - 45) AS LLEGAPO, PP.FECEMB AS EMB, TE.DESCRIPCION AS TIPEMB, dbo.DESTINOS.NOMBRE AS TIENDA, ISNULL(PP.OBSERVA, 
                         '') AS OBS, PP.CLIENTE AS CLI, CL.NOMBRE AS NOM, ES.FOTO AS FOT, ES.CONTENIDO AS CON, dbo.TEMPORADAS.DESCRIPCION AS DESTEMPORADA, 
                         PR.TEMPORADA AS CODTEM, PP.ESTADO, PR.VERSION, PR.AJUSTE,PR.AJUSTE+'-'+PR.VERSION AS 'PROTOVERSION'
FROM            dbo.POS AS PP INNER JOIN
                         dbo.COTIZACION AS CC ON PP.COTIZACION = CC.COTIZACION INNER JOIN
                         dbo.AJUSTES AS PR ON CC.PROTO = PR.AJUSTE AND CC.VERSION = PR.VERSION INNER JOIN
                         dbo.CLIENTE AS CL ON PP.CLIENTE = CL.CODIGO INNER JOIN
                         dbo.TIPOEMBARQUE AS TE ON PP.TIPOEMB = TE.CODIGO INNER JOIN
                         dbo.ESTILOS AS ES ON PR.CLIENTE = ES.CLIENTE AND PR.ESTILO = ES.CODEST INNER JOIN
                         dbo.DESTINOS ON PP.DESTINO = dbo.DESTINOS.CODIGO INNER JOIN
                         dbo.TEMPORADAS ON PR.TEMPORADA = dbo.TEMPORADAS.CODIGO AND PR.CLIENTE = dbo.TEMPORADAS.CLIENTE

GO
